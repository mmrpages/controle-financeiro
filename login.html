<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Finan√ßas 2026</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="auth-card" role="form" aria-labelledby="authTitle">
    <h2 id="authTitle">Acessar Sistema</h2>
    <p id="authSubtitle">Entre com seu e-mail e senha</p>

    <div id="errorMessage" class="error-message" aria-live="polite"></div>

    <!-- Mant√©m formata√ß√£o original -->
    <form onsubmit="handleAuth(); return false;">
      <input type="email"
             id="email"
             class="auth-input"
             placeholder="Seu e-mail"
             autocomplete="email"
             required>
      <input type="password"
             id="password"
             class="auth-input"
             placeholder="Sua senha (m√≠n. 6 caracteres)"
             autocomplete="current-password"
             required
             minlength="6">
      <button id="mainBtn" class="auth-btn" type="submit">Entrar</button>
    </form>

    <!-- Esqueci minha senha -->
    <div class="auth-toggle" onclick="forgotPasswordPrompt()">Esqueceu a senha? <b>Recuperar</b></div>

    <!-- Alternar login/cadastro -->
    <div class="auth-toggle" onclick="toggleMode()" id="toggleText">
      N√£o tem conta? <b>Criar agora</b>
    </div>
  </div>

  <script type="module">
    import firebaseConfig from './config.js';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      sendPasswordResetEmail,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    let isLogin = true;

    // Alternar login/cadastro
    window.toggleMode = () => {
      isLogin = !isLogin;
      document.getElementById('authTitle').innerText = isLogin ? "Acessar Sistema" : "Criar Conta";
      document.getElementById('authSubtitle').innerText = isLogin ? "Entre com seu e-mail e senha" : "Crie sua conta gratuitamente";
      document.getElementById('mainBtn').innerText = isLogin ? "Entrar" : "Cadastrar";
      document.getElementById('toggleText').innerHTML = isLogin
        ? "N√£o tem conta? <b>Criar agora</b>"
        : "J√° tem conta? <b>Fazer Login</b>";
      hideError();
    };

    // Exibir erros
    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.classList.add('show');
    }
    function hideError() {
      document.getElementById('errorMessage').classList.remove('show');
    }

    // Aviso de senha fraca (n√£o bloqueia)
    function checkPasswordStrength(password) {
      const strongRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/;
      if (password.length < 6) {
        showError("‚ö†Ô∏è Sua senha √© curta. Recomendamos usar pelo menos 8 caracteres.");
      } else if (!strongRegex.test(password)) {
        showError("‚ö†Ô∏è Senha fraca. Considere usar letras mai√∫sculas, min√∫sculas, n√∫meros e s√≠mbolos.");
      }
    }

    // Login/Cadastro
    window.handleAuth = async () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!email || !password) {
        showError('Por favor, preencha todos os campos');
        return;
      }
      if (!email.includes('@')) {
        showError('Por favor, insira um e-mail v√°lido');
        return;
      }

      // Apenas avisa, n√£o bloqueia
      checkPasswordStrength(password);

      hideError();
      try {
        if (isLogin) {
          await signInWithEmailAndPassword(auth, email, password);
        } else {
          await createUserWithEmailAndPassword(auth, email, password);
        }
        window.location.href = 'index.html';
      } catch (error) {
        console.error('Erro de autentica√ß√£o:', error);
        showError("E-mail ou senha inv√°lidos");
      }
    };

    // Esqueci minha senha
    window.forgotPasswordPrompt = async () => {
      const email = document.getElementById('email').value.trim();
      if (!email) {
        showError("Digite seu e-mail para recuperar a senha");
        return;
      }
      try {
        await sendPasswordResetEmail(auth, email);
        alert("üìß Email de redefini√ß√£o enviado! Verifique sua caixa de entrada.");
      } catch (error) {
        console.error("Erro ao enviar email de redefini√ß√£o:", error);
        showError("Erro ao enviar email. Verifique se o e-mail est√° correto.");
      }
    };

    // Logout seguro
    window.logout = async () => {
      await signOut(auth);
      window.location.href = "login.html";
    };

    // Prote√ß√£o de sess√£o
    onAuthStateChanged(auth, (user) => {
      if (!user && window.location.pathname.includes("index.html")) {
        window.location.href = "login.html";
      }
    });
  </script>

</body>
</html>
